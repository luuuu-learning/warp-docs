---
sidebar_position: 4
---

import Admonition from '@theme/Admonition';

# Conditions

Conditions represent event definitions, and they outline the circumstances under which a job can be completed. A condition is a recursive data type that allows for multiple conditions within it, all of which need to resolve to true for the Job to allow execution. This complex data type includes several underlying types.

A condition is either a combination of conditions or a single expression. Conditions can be nested and chained using regular boolean operators, such as `And`, `Or`, or `Not`. 

```rust
pub enum Condition {
    And(Vec<Box<Condition>>),
    Or(Vec<Box<Condition>>),
    Not(Box<Condition>),
    Expr(Expr),
}
```

## Expressions

Expressions contain comparisons of popular data types, such as integers, unsigned integers, timestamps, booleans, strings, and more.

```rust keeper.rs
pub enum Expr {
    String(GenExpr<Value<String>, StringOp>),
    Uint(GenExpr<Value<Uint256>, NumOp>),
    Int(GenExpr<Value<i128>, NumOp>),
    Decimal(GenExpr<Value<Decimal256>, NumOp>),
    Timestamp(TimeExpr),
    BlockHeight(TimeExpr),
    Bool(QueryExpr),
}
```

## Values

A value is the most primitive type of input that we can have in an expression. Within double-sided [general expressions](#general-expressions), the value can either be a primitive type or a query that gets a primitive type. 


## General expressions

<CH.Section>

General expressions or _`GenExpr`_ are used to compare two values using a [_`left:`_](focus://2) value, an operator [_`op:`_](focus://3), and a [_`right:`_](focus://4) value. The operators of general expressions vary depending on the value type. 

```rust keeper.rs
pub struct GenExpr<Type, Op> {
    pub left: Type,
    pub op: Op,
    pub right: Type,
}
```

</CH.Section>


<Admonition type="tip" icon="âœ…" title="Comparing values">

Only values of the same _`Type`_ can be compared when writing an expression. 

</Admonition>



### String operators

The following operators are used in general expressions that compare strings. 

```rust keeper.rs
#[cw_serde]
pub enum StringOp {
    StartsWith,
    EndsWith,
    Contains,
    Eq,
    Neq,
}
```

### Number operators

The following operators are used in general expressions that compare integers or decimals. 

```rust keeper.rs
#[cw_serde]
pub enum NumOp {
    Eq,
    Neq,
    Lt,
    Gt,
    Gte,
    Lte,
}
```

## Time expressions

Time expressions are like regular unsigned integer expressions, except they only contain a left value and a number operator. The right value is filled by a _`BlockHeight`_ or _`Timestamp`_, depending on the value type.

```rust keeper.rs
pub struct TimeExpr {
    pub comparator: Uint64,
    pub op: NumOp,
}
```


## Query expressions

Query expressions are complex expressions that select a value from a query message. The structure of a _`QueryExpr`_ contains a selector, a query JSON, a contract address, and a name. 

```rust keeper.rs
pub struct QueryExpr {
    pub selector: String,
    pub query: String,
    pub contract: String,
    pub name: String,
}
```

Query expressions can be used as one or both of the values in a [general expression](#general-expressions), or in [boolean expressions](#bool). When query expressions are used in a condition, the JSON of a query message is sent out, and the value specified by the selector string is returned as the value to be compared in the general expression. 

### Selectors

Selector strings are used in query expressions to select the JSON path of the query response. This string is essentially the path that Warp needs to take within that particular query response to get the value that needs comparing. 

**Example**:

To select _`"bend"`_ as the desired portion of the query response below, the _`$.address.city`_ selector is used. The _`$`_ in the selector refers to the root object/element. 

```javascript example.json
{
"address": {
        "streetAddress": "high street",
        "city": "bend",
        "postalCode": "97701"
}

}
```

For a hands-on example of JSON paths and selectors, visit the [JSON path evaluator](https://jsonpath.com/).
To learn more about JSON selectors, visit the [JSON path Github repo](https://github.com/json-path/JsonPath). 

### Bool

Queries can also be written as boolean expressions, in which a query selector is evaluated as a boolean. 
